version: '2'
services:
    testphp:
        container_name: accountelyby_testphp
        image: account_testphp
        build:
            context: ../
            dockerfile: Dockerfile-dev
        depends_on:
            - testdb
            - testredis
            - testrabbit
        volumes:
            - ./..:/var/www/html
        environment:
            YII_DEBUG: "true"
            YII_ENV: "test"
            # DB config
            DB_HOST: "testdb"
            DB_DATABASE: "ely_accounts_test"
            DB_USER: "ely_accounts_tester"
            DB_PASSWORD: "ely_accounts_tester_password"
            # Redis config
            REDIS_HOST: "testredis"
            # RabbitMQ config
            RABBITMQ_HOST: "testrabbit"
            RABBITMQ_USER: "ely-accounts-tester"
            RABBITMQ_PASS: "tester-password"
            RABBITMQ_VHOST: "/account.ely.by/tests"
            # Это я потом, когда-нибудь, уберу
            XDEBUG_CONFIG: "remote_host=10.254.254.254"
            PHP_IDE_CONFIG: "serverName=docker"

    testdb:
        container_name: accountelyby_testdb
        image: account_testdb
        build: ./../docker/mariadb
        environment:
            MYSQL_ROOT_PASSWORD: ""
            MYSQL_ALLOW_EMPTY_PASSWORD: "yes"
            MYSQL_DATABASE: "ely_accounts_test"
            MYSQL_USER: "ely_accounts_tester"
            MYSQL_PASSWORD: "ely_accounts_tester_password"

    testredis:
        container_name: accountelyby_testredis
        image: redis:3.0-alpine

    testrabbit:
        container_name: accountelyby_testrabbit
        image: rabbitmq:3.6
        environment:
            RABBITMQ_DEFAULT_USER: "ely-accounts-tester"
            RABBITMQ_DEFAULT_PASS: "tester-password"
            RABBITMQ_DEFAULT_VHOST: "/account.ely.by/tests"
